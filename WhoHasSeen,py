import tableauserverclient as TSC

# --- Configuration ---
TABLEAU_SERVER_URL = "https://uat.insights.citigroup.net"
PAT_NAME = "API_Call"
PAT_SECRET = "sDCBtBCCQwiD2Kg0ZvVPxQ==:7fcZtHwkz6VwQtLZ0MwwRMgaXKvkAeJ4"
SITE_ID = "GCT"  # Confirm this is correct

# --- Code ---
tableau_auth = TSC.PersonalAccessTokenAuth(PAT_NAME, PAT_SECRET, site_id=SITE_ID)
server = TSC.Server(TABLEAU_SERVER_URL, use_server_version=True)
server.add_http_options({'verify': False})

try:
    with server.auth.sign_in(tableau_auth):
        print(f"Authenticated to site: {server.auth.site_id}")

        # List all workbooks to verify existence
        all_workbooks, _ = server.workbooks.get()
        print("Workbooks in site:")
        for wb in all_workbooks:
            print(f"ID: {wb.id}, Name: {wb.name}")

        # If 5186 is valid:
        workbook = server.workbooks.get_by_id('5186')  # Use string, not int
        print(f"Workbook found: {workbook.name}")

        # Continue with view extraction...

except Exception as e:
    print(f"Error: {e}")
